{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://hybrid-thought.com/pisa/interchange",

  "title": "PISA Process Interchange Representation",
  "type": "object",
  "required": ["meta", "entry", "steps"],
  "properties": {
    "meta": {
      "type": "object",
      "description": "Metadata about a process",
      "required": ["name"],
      "properties": {
        "name": {
          "type": "string",
          "description": "The name of the process"
        },
        "description": {
          "type": "string",
          "description": "A brief description of the process"
        },
        "version": {
          "type": "string",
          "description": "The version of the process"
        }
      },
      "additionalProperties": {
        "type": "string",
        "description": "Additional metadata associated with the process"
      }
    },
    "entry": {
      "type": "array",
      "description": "The entry points of the process",
      "items": {
        "type": "string",
        "pattern": "^[a-zA-Z].*$",
        "description": "The step id of an entry point"
      },
      "minItems": 1
    },
    "steps": {
      "type": "object",
      "description": "The steps in the process, with the keys as the step ids.",
      "patternProperties": {
        "^[a-zA-Z].*$": {
          "type": "object",
          "required": ["meta", "states", "entry"],
          "properties": {
            "meta": {
              "type": "object",
              "description": "Metadata about a process step",
              "required": ["name"],
              "properties": {
                "name": {
                  "type": "string",
                  "description": "The name of the process step"
                },
                "description": {
                  "type": "string",
                  "description": "A brief description of the process step"
                },
                "version": {
                  "type": "string",
                  "description": "The version of the process step"
                }
              },
              "additionalProperties": {
                "type": "string",
                "description": "Additional metadata associated with the process step"
              }
            },
            "attributes": {
              "type": "object",
              "description": "The attribute interface for the step with the keys being the parameter names, Parameter names may be prefixed with an underscore to indicate that they are internal to the step",
              "patternProperties": {
                "^_?[a-zA-Z].*$": {
                  "type": "object",
                  "description": "The declaration of the attribute",
                  "required": ["type", "mode"],
                  "properties": {
                    "type": {
                      "type": "string",
                      "description": "The type of the attribute"
                    },
                    "mode": {
                      "type": "string",
                      "enum": ["input", "output", "input-output", "local"],
                      "description": "The mode of the attribute"
                    },
                    "description": {
                      "type": "string",
                      "description": "A brief description of the attribute"
                    }
                  },
                  "additionalProperties": false
                }
              },
              "additionalProperties": false
            },
            "states": {
              "type": "object",
              "description": "The states of the step, with the keys being the state names. Internal state names may be prefixed with an underscore",
              "patternProperties": {
                "^_?[a-zA-Z].*": {
                  "type": "object",
                  "description": "The events that the state responds to",
                  "patternProperties": {
                    "^[a-zA-Z].*": {
                      "type": "object",
                      "description": "The guard predicates, must include atleast 'true'",
                      "patternProperties": {
                        "^[a-zA-Z].*": {
                          "type": "array",
                          "description": "The sequence of operations to be performed by the step in response to an event",
                          "items": {
                            "type": "object",
                            "description": "An operation with arguments",
                            "propertyNames": {
                              "$comment": "Enum of operation names",
                              "enum": [""]
                            },
                            "patternProperties": {
                              "^[a-zA-Z].*$": {
                                "type": "object",
                                "description": "The arguments to the operation",
                                "patternProperties": {
                                  "^[a-zA-Z].*$": {
                                    "type": "string"
                                  }
                                },
                                "additionalProperties": false
                              }
                            },
                            "additionalProperties": false,
                            "minProperties": 1,
                            "maxProperties": 1
                          },
                          "minItems": 1
                        }
                      },
                      "additionalProperties": false,
                      "minProperties": 1
                    }
                  },
                  "additionalProperties": false,
                  "minProperties": 1
                }
              },
              "additionalProperties": false,
              "minProperties": 1
            },
            "entry": {
              "type": "string",
              "pattern": "^_?[a-zA-Z].*",
              "description": "The initial state for the step."
            }
          },
          "additionalProperties": false,
          "minProperties": 1
        }
      },
      "additionalProperties": false,
      "minProperties": 1
    }
  },
  "additionalProperties": false
}
